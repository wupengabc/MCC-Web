<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>用户设置</title>
    <link href="/static/css/tabler.css" rel="stylesheet">
    <script src="/static/js/tabler.js"></script>
</head>
<body>
<div class="page">
    <header class="navbar navbar-expand-md d-print-none header1">
        <div class="container-xl">
            <div class="navbar-brand navbar-brand-autodark d-none-navbar-horizontal pe-0 pe-md-3">
                <a href="/">
                    <img alt="" class="navbar-brand-image" height="32" src="/static/img/MCC_logo.png"
                         viewBox="0 0 232 68"
                         width="110">
                </a>
                <span>
                    &nbsp;MCC Bot Manager
                </span>
            </div>
            <div class="navbar-nav flex-row order-md-last">
                <div class="nav-item dropdown">
                    <button class="nav-link px-0" data-bs-placement="bottom" data-bs-toggle="tooltip"
                            onclick="shownotice()"
                            title="更新日志" type="button">
                        <!-- Download SVG icon from http://tabler-icons.io/i/bell -->
                        <svg class="icon" height="24" p-id="5439" t="1725190791501"
                             version="1.1" viewBox="0 0 1024 1024" width="24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M897.28 170.666667h-750.933333c-28.16 0-51.2 23.04-51.2 51.2v665.6c0 28.16 23.04 51.2 51.2 51.2h750.933333c28.16 0 51.2-23.04 51.2-51.2V221.866667c0-28.16-22.613333-51.2-51.2-51.2z m-17.066667 699.733333h-716.8V238.933333h716.8v631.466667z"
                                  fill="#2c2c2c" p-id="5440"></path>
                            <path d="M744.96 699.733333H333.226667c-18.346667 0-32.853333-14.933333-32.853334-32.853333v-2.133333c0-18.346667 14.933333-32.853333 32.853334-32.853334h411.733333c18.346667 0 32.853333 14.933333 32.853333 32.853334v2.133333c0 17.92-14.506667 32.853333-32.853333 32.853333zM743.68 546.133333h-221.866667c-18.773333 0-34.133333-15.36-34.133333-34.133333s15.36-34.133333 34.133333-34.133333h221.866667c18.773333 0 34.133333 15.36 34.133333 34.133333s-14.933333 34.133333-34.133333 34.133333zM718.08 307.2c-18.773333 0-34.133333-15.36-34.133333-34.133333V119.466667c0-18.773333 15.36-34.133333 34.133333-34.133334s34.133333 15.36 34.133333 34.133334v153.6c0 18.773333-14.933333 34.133333-34.133333 34.133333zM325.546667 307.2c-18.773333 0-34.133333-15.36-34.133334-34.133333V119.466667c0-18.773333 15.36-34.133333 34.133334-34.133334s34.133333 15.36 34.133333 34.133334v153.6c0 18.773333-14.933333 34.133333-34.133333 34.133333z"
                                  fill="#2c2c2c" p-id="5441"></path>
                        </svg>
                    </button>
                </div>
                &nbsp;&nbsp;
                <div class="nav-item dropdown">
                    <a aria-label="Open user menu" class="nav-link d-flex lh-1 text-reset p-0" data-bs-toggle="dropdown"
                       href="#">
                        <span class="avatar avatar-sm"
                              style="background-image: url('https://mineskin.eu/avatar/{{.username}}')"></span>
                        <div class="d-none d-xl-block ps-2">
                            <div>{{.username}}</div>
                            <div class="mt-1 small text-secondary">权限等级:{{.permission}}</div>
                        </div>
                    </a>
                    <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow"
                         style="left: 50%; transform: translateX(-50%);">
                        <a class="dropdown-item" href="/setting">账户信息</a>
                        <a class="dropdown-item" href="https://gitee.com/sg250/MCC-Web/issues"
                           target="_blank">问题反馈</a>
                        <a class="dropdown-item" href="/logout">登出</a>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <div class="page-body">
        <div class="container-xl">
            <div class="page-header">
                <div class="page-title">
                    <a class="btn btn-sm" href="/panel">返回面板</a>
                </div>
            </div>
        </div>
        <div class="page-wrapper">
            <div class="modal fade" id="notice" tabindex="-1">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">更新日志</h5>
                            <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
                        </div>
                        <div id="notice_content" style="max-height: 70vh; overflow-y: auto;"></div>
                        <div class="modal-footer">
                            <button aria-label="Close" class="btn align-items-end" data-bs-dismiss="modal">确定</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="surechangeusername" tabindex="-1">
                <div class="modal-dialog modal-sm" role="document">
                    <div class="modal-content">
                        <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
                        <div class="modal-status bg-danger"></div>
                        <div class="modal-body text-center py-4">
                            <svg class="icon mb-2 text-danger icon-lg" fill="none" height="24"
                                 stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"
                                 width="24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M0 0h24v24H0z" fill="none" stroke="none"/>
                                <path d="M12 9v2m0 4v.01"/>
                                <path d="M5 19h14a2 2 0 0 0 1.84 -2.75l-7.1 -12.25a2 2 0 0 0 -3.5 0l-7.1 12.25a2 2 0 0 0 1.75 2.75"/>
                            </svg>
                            <h3>确定修改用户名?</h3>
                            <div class="text-secondary"><p>你确定要修改你的用户名?</p>修改前请检查是否删除全部Bot!!!
                            </div>
                        </div>
                        <div class="modal-footer">
                            <div class="w-100">
                                <div class="row">
                                    <div class="col"><a class="btn w-100" data-bs-dismiss="modal" href="#">
                                        取消
                                    </a></div>
                                    <div class="col"><a class="btn btn-danger w-100" data-bs-dismiss="modal" href="#"
                                                        onclick="changeusername()">
                                        确定
                                    </a></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="surechangepassword" tabindex="-1">
                <div class="modal-dialog modal-sm" role="document">
                    <div class="modal-content">
                        <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
                        <div class="modal-status bg-danger"></div>
                        <div class="modal-body text-center py-4">
                            <svg class="icon mb-2 text-danger icon-lg" fill="none" height="24"
                                 stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"
                                 width="24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M0 0h24v24H0z" fill="none" stroke="none"/>
                                <path d="M12 9v2m0 4v.01"/>
                                <path d="M5 19h14a2 2 0 0 0 1.84 -2.75l-7.1 -12.25a2 2 0 0 0 -3.5 0l-7.1 12.25a2 2 0 0 0 1.75 2.75"/>
                            </svg>
                            <h3>确定修改密码?</h3>
                            <div class="text-secondary"><p>你确定要修改你的密码?</p>修改前请记住新密码!!!
                            </div>
                        </div>
                        <div class="modal-footer">
                            <div class="w-100">
                                <div class="row">
                                    <div class="col"><a class="btn w-100" data-bs-dismiss="modal" href="#">
                                        取消
                                    </a></div>
                                    <div class="col"><a class="btn btn-danger w-100" data-bs-dismiss="modal" href="#"
                                                        onclick="changepassword()">
                                        确定
                                    </a></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="tips" tabindex="-1">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">提示</h5>
                            <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
                        </div>
                        <div class="modal-body">
                            <div id="tip_content"></div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-primary" data-bs-dismiss="modal" type="button">确定</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-xl">
                <div class="card">
                    <div class="card-header">
                        <ul class="nav nav-tabs card-header-tabs" data-bs-toggle="tabs">
                            <li class="nav-item">
                                <a class="nav-link active" data-bs-toggle="tab" href="#userinfo">账户信息</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" href="#sharebot">分享Bot</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" href="#changeusername">修改用户名</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" href="#changepassword">修改密码</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" href="#updatepermission">权限升级</a>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content">
                            <div class="tab-pane active show" id="userinfo">
                                <div class="row row-cards">
                                    <div class="col-sm-6 col-lg-3">
                                        <div class="card card-sm">
                                            <div class="card-body">
                                                <div class="row align-items-center">
                                                    <div class="col-auto">
                            <span class="text-white avatar"><!-- Download SVG icon from http://tabler-icons.io/i/brand-facebook -->
<svg class="icon" height="24" p-id="4283" t="1725351187875" version="1.1" viewBox="0 0 1024 1024"
     width="24" xmlns="http://www.w3.org/2000/svg"><path
        d="M648.6 538.9c63.2-46.6 104.2-121.6 104.2-206C752.8 191.8 638 77 496.9 77S241 191.8 241 332.9c0 84.4 41.1 159.4 104.2 206C200.4 598.7 98.3 741.4 98.3 907.5c0 22.1 17.9 40 40 40s40-17.9 40-40c0-175.8 143-318.7 318.7-318.7s318.7 143 318.7 318.7c0 22.1 17.9 40 40 40s40-17.9 40-40c-0.1-166.1-102.3-308.8-247.1-368.6z m-327.7-206c0-97.1 79-176 176-176s176 79 176 176-79 176-176 176-176-79-176-176z"
        fill="#1296db" p-id="4284"></path></svg>
                            </span>
                                                    </div>
                                                    <div class="col">
                                                        <div class="font-weight-medium">
                                                            用户名: {{.username}}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6 col-lg-3">
                                        <div class="card card-sm">
                                            <div class="card-body">
                                                <div class="row align-items-center">
                                                    <div class="col-auto">
                            <span class="text-white avatar"><!-- Download SVG icon from http://tabler-icons.io/i/brand-facebook -->
<svg class="icon" height="24" p-id="4291" t="1725285074688" version="1.1" viewBox="0 0 1024 1024"
     width="24" xmlns="http://www.w3.org/2000/svg"><path
        d="M768 416.914286c43.885714-43.885714 43.885714-109.714286 0-153.6-43.885714-43.885714-117.028571-43.885714-160.914286-7.314286s-43.885714 109.714286 0 153.6 117.028571 51.2 160.914286 7.314286zM658.285714 365.714286c-14.628571-14.628571-14.628571-36.571429 0-51.2 14.628571-14.628571 36.571429-14.628571 51.2 0 14.628571 14.628571 14.628571 36.571429 0 51.2s-36.571429 14.628571-51.2 0z m-512 563.2c-14.628571 14.628571-36.571429 14.628571-51.2 0s-14.628571-36.571429 0-51.2l387.657143-387.657143-14.628571-21.942857c-58.514286-102.4-43.885714-226.742857 36.571428-314.514286 102.4-102.4 263.314286-102.4 358.4 0s102.4 263.314286 0 358.4c-80.457143 87.771429-204.8 102.4-307.2 43.885714l-21.942857-14.628571-160.914286 160.914286 80.457143 80.457142c14.628571 14.628571 36.571429 14.628571 51.2 0 14.628571-14.628571 14.628571-36.571429 0-51.2l-21.942857-29.257142 65.828572-65.828572c124.342857 58.514286 277.942857 36.571429 373.028571-65.828571 131.657143-131.657143 131.657143-336.457143 0-468.114286S585.142857-21.942857 453.485714 102.4c-95.085714 102.4-124.342857 248.685714-65.828571 373.028571L36.571429 826.514286c-43.885714 43.885714-43.885714 109.714286 0 153.6 43.885714 43.885714 109.714286 43.885714 153.6 0l80.457142-80.457143-51.2-43.885714-73.142857 73.142857z m307.2-51.2l-131.657143-131.657143-51.2 58.514286 131.657143 131.657142c14.628571 14.628571 36.571429 14.628571 51.2 0 14.628571-21.942857 14.628571-43.885714 0-58.514285z"
        fill="#d81e06" p-id="4292"></path></svg>                            </span>
                                                    </div>
                                                    <div class="col">
                                                        <div class="font-weight-medium">
                                                            权限等级: {{.permission}}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6 col-lg-3">
                                        <div class="card card-sm">
                                            <div class="card-body">
                                                <div class="row align-items-center">
                                                    <div class="col-auto">
                                                        <span class="text-white avatar">
                                                            <svg class="icon" height="24" p-id="6167"
                                                                 t="1725285392618" version="1.1"
                                                                 viewBox="0 0 1024 1024" width="24" xmlns="http://www.w3.org/2000/svg"><path
                                                                    d="M554.666667 251.733333V341.333333h341.333333v426.666667H170.666667V341.333333h341.333333V251.733333c-25.6-8.533333-42.666667-34.133333-42.666667-59.733333 0-34.133333 29.866667-64 64-64s64 29.866667 64 64c0 29.866667-17.066667 51.2-42.666666 59.733333zM512 384H213.333333v341.333333h640V384h-341.333333z m-384 85.333333v213.333334H85.333333v-213.333334h42.666667z m853.333333 0v213.333334h-42.666666v-213.333334h42.666666zM384 597.333333c-25.6 0-42.666667-17.066667-42.666667-42.666666s17.066667-42.666667 42.666667-42.666667 42.666667 17.066667 42.666667 42.666667-17.066667 42.666667-42.666667 42.666666z m298.666667 0c-25.6 0-42.666667-17.066667-42.666667-42.666666s17.066667-42.666667 42.666667-42.666667 42.666667 17.066667 42.666666 42.666667-17.066667 42.666667-42.666666 42.666666z"
                                                                    fill="#13931c" p-id="6168"></path></svg>
                                                        </span>
                                                    </div>
                                                    <div class="col">
                                                        <div class="font-weight-medium">
                                                            机器人数量: {{.count}}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane show" id="sharebot">
                                <h1>该功能设计中, 请耐心等待</h1>
                            </div>
                            <div class="tab-pane show" id="changeusername">
                                <div class="container-tight">
                                    <form id="form1">
                                        <div class="mb-3">
                                            <label class="form-label">旧用户名</label>
                                            <input class="form-control" disabled id="oldusername"
                                                   placeholder="输入您的旧用户名" type="text" value="{{.username}}"/>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">新用户名</label>
                                            <input class="form-control" id="newusername" placeholder="输入您的新用户名"
                                                   type="text"/>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">重复新用户名</label>
                                            <input class="form-control" id="againnewusername" placeholder="再次输入您的新用户名"
                                                   type="text"/>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-check">
                                                <input class="form-check-input" id="confirm_changeusername"
                                                       type="checkbox">
                                                <span class="form-check-label required">我已删除全部Bot, 且同意修改用户名</span>
                                            </label>
                                        </div>
                                        <div class="mb-3 d-flex">
                                            <button class="btn btn-secondary" onclick="resetbtn1()" type="reset">重置
                                            </button>
                                            <button class="btn btn-primary ms-auto" data-bs-target="#surechangeusername" data-bs-toggle="modal"
                                                    disabled id="changeusernametrue">修改
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <div class="tab-pane show" id="changepassword">
                                <div class="container-tight">
                                    <form id="form2">
                                        <div class="mb-3">
                                            <label class="form-label">旧密码</label>
                                            <input class="form-control" id="oldpassword" placeholder="输入您的旧密码"
                                                   type="text"/>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">新密码</label>
                                            <input class="form-control" id="newpassword" placeholder="输入您的新密码"
                                                   type="text"/>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">重复新密码</label>
                                            <input class="form-control" id="againpassword" placeholder="再次输入您的新密码"
                                                   type="text"/>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-check">
                                                <input class="form-check-input" id="confirm_changepassword"
                                                       type="checkbox">
                                                <span class="form-check-label required">我已确认修改密码</span>
                                            </label>
                                        </div>
                                        <div class="mb-3 d-flex">
                                            <button class="btn btn-secondary" onclick="resetbtn2()" type="reset">重置
                                            </button>
                                            <button class="btn btn-primary ms-auto" data-bs-target="#surechangepassword" data-bs-toggle="modal"
                                                    disabled id="changepasswordtrue">修改
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <div class="tab-pane show" id="updatepermission">
                                <h1>该功能设计中, 请耐心等待</h1>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function resetbtn1() {
        document.getElementById('changeusernametrue').disabled = true
    }

    function resetbtn2() {
        document.getElementById('changepasswordtrue').disabled = true
    }

    function shownotice() {
        notice_item = new bootstrap.Modal(document.getElementById("notice"))
        notice_item.show()
        fetch("/getnotice", {
            method: "GET",
        }).then(response => response.json()).then(data => {
            document.getElementById("notice_content").innerHTML = ""
            for (item5 of data.data) {
                content = `
                    <div class="modal-body">
                    ${item5.Message}
</div>
               `
                document.getElementById("notice_content").innerHTML = content + document.getElementById("notice_content").innerHTML
            }
        }).catch(error => {
            show_tip(error)
        })
    }

    document.addEventListener("DOMContentLoaded", function () {
        const newUsername = document.getElementById("newusername");
        const againNewUsername = document.getElementById("againnewusername");
        const confirmCheckbox = document.getElementById("confirm_changeusername");
        const changeButton = document.getElementById("changeusernametrue");
        const oldPassword = document.getElementById("oldpassword");
        const newPassword = document.getElementById("newpassword");
        const againNewPassword = document.getElementById("againpassword");
        const confirmCheckbox2 = document.getElementById("confirm_changepassword");
        const changeButton2 = document.getElementById("changepasswordtrue");

        function validateForm() {
            const usernamesMatch = newUsername.value === againNewUsername.value && newUsername.value !== "";
            const checkboxChecked = confirmCheckbox.checked;

            changeButton.disabled = !(usernamesMatch && checkboxChecked);
        }

        function validateForm2() {
            const passwordsMatch = newPassword.value === againNewPassword.value && newPassword.value !== "" && oldPassword.value !== "";
            const checkboxChecked = confirmCheckbox2.checked;

            changeButton2.disabled = !(passwordsMatch && checkboxChecked);
        }

        newUsername.addEventListener("input", validateForm);
        againNewUsername.addEventListener("input", validateForm);
        confirmCheckbox.addEventListener("change", validateForm);
        newPassword.addEventListener("input", validateForm2);
        againNewPassword.addEventListener("input", validateForm2);
        oldPassword.addEventListener("input", validateForm2);
        confirmCheckbox2.addEventListener("change", validateForm2)
    });
    document.getElementById("form1").addEventListener("submit", function (event) {
        event.preventDefault();
    });
    document.getElementById("form2").addEventListener("submit", function (event) {
        event.preventDefault();
    });
    function show_tips(msg) {
        item = document.getElementById("tips")
        modal = new bootstrap.Modal(item)
        tips_msg_item = document.getElementById("tip_content")
        tips_msg_item.textContent = ""
        tips_msg_item.textContent = msg
        modal.show()
    }

    function changeusername() {
        oldusername = document.getElementById("oldusername").value
        newusername = document.getElementById("newusername").value
        data18 = {
            oldusername: oldusername,
            newusername: newusername
        }
        fetch("/changeusername", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(data18)
        }).then(response => response.json()).then(data => {
            if (data.code === 200) {
                show_tips(data.data)
                setTimeout(() => {
                    window.location.href = "/setting";
                }, 2000)
            } else {
                show_tips(data.data)
            }
        }).catch(error => {
            show_tips(error)
        })
    }
    function changepassword(){
        oldpassword = document.getElementById("oldpassword").value
        newpassword = document.getElementById("newpassword").value
        username = document.getElementById("oldusername").value
        data19 = {
            username: username,
            oldpassword: oldpassword,
            newpassword: newpassword
        }
        fetch("/changepassword", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(data19)
        }).then(response => response.json()).then(data => {
            if (data.code === 200) {
                show_tips(data.msg)
                setTimeout(() => {
                    window.location.href = "/setting";
                }, 2000)
            } else {
                show_tips(data.msg)
            }
        }).catch(error=>{
            show_tips(error)
        })
    }
</script>
</body>
</html>